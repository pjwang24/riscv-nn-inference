# Improvement Log â€” 2026-02-19

## Dual-Issue Bring-Up + Timing Recovery

### Objective
Bring the CPU from verified single-issue toward usable dual-issue, then recover post-synthesis timing so IPC improvements are meaningful at realistic clock targets.

### What We Integrated
1. 64-bit fetch path and dual-lane IF/ID wiring.
2. Lane 1 hazard plumbing and issue gating.
3. Lane 1 EX/WB path and dual-write regfile behavior.
4. Dual-issue fetch advance feedback (`+8` path when dual-issued).

### Main Challenges We Hit
1. Flush-window ghost dual-issue behavior caused wrong `PC+8` advances on bubble cycles.
2. Front-end phase/alignment issues around 1-cycle I$ response behavior and lane consumption.
3. EX/ID forwarding correctness during dual-lane interactions.
4. Critical timing collapse from combinational M-extension divide/remainder logic sitting on the EX->ID forwarding-sensitive cone.

## Current Tuning Direction (Applied Today)

### Rationale
The timing limiter was not small ALU logic; it was deep combinational M-extension behavior (especially DIV/REM) coupled with forwarding paths. This masked all other bottlenecks and made dual-issue gains hard to realize in silicon.

### RTL Changes Implemented
1. `MUL`-only M-extension behavior in fast path.
2. `DIV/DIVU/REM/REMU` stubbed to `0` in `Multiplier.sv`.
3. Simulation-only assertion on unsupported DIV/REM usage.
4. No EX->ID forwarding for M-extension results (treated like load-use hazard for forwarding control).

## Functional Results (Pre-Syn)

From `make clean && make run` in `riscv-nn-inference`:

1. Single-issue:
   - PASS after `2,058,029` cycles
   - IPC `0.858060`
2. Dual-issue (`ENABLE_DUAL_ISSUE=1`):
   - PASS after `1,906,211` cycles
   - IPC `0.926436`

Dual-issue remains functionally correct and shows expected throughput improvement.

## Core-Only STA Results (Sky130 TT 1.8V 25C)

Constraint style for core-only analysis:
1. `set_false_path -from [all_inputs]`
2. `set_false_path -to [all_outputs]`
3. 17.0 ns clock, 0.25 ns uncertainty

### Before MUL-only tuning
1. Worst reg->reg data arrival: `74.13 ns`
2. Slack: `-57.46 ns`
3. Implied fmax: `~13.43 MHz`

### After MUL-only tuning
1. Worst reg->reg data arrival: `12.51 ns`
2. Slack: `+4.15 ns` (timing met)
3. Implied fmax: `~77.82 MHz`

### Net Impact
Timing recovery is substantial (`~5.8x` implied fmax improvement), turning the design from clearly timing-broken to timing-feasible under core-only STA assumptions.

## Notes on OpenLane STA Interpretation
OpenLane synthesis STA (`2-sta.log`) still reads `base.sdc` by default (with IO delay/load assumptions). For architecture-focused analysis, we used standalone core-only STA to isolate reg->reg behavior.

## Next Steps
1. Run PAR and post-route timing to verify this gain holds after placement/routing and CTS.
2. Perform micro-optimization pass on remaining critical cones:
   - fanout control on hot control nets
   - control pipelining / register slicing in long decode-forwarding paths
   - targeted mux-depth cleanup in operand/forwarding selection logic
3. Re-check IPC vs timing tradeoff after PAR to decide next dual-issue policy refinements.
