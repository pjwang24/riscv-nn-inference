# Improvement Log 2026-02-23

## Scope
This log records work that targeted dual issue throughput for the NN workload with correctness held constant.
The objective was DI IPC above 1.0 with both SI and DI runs passing.

## Baseline
Initial measurements before new tuning on this date

1. Single issue  
   cycles 1583516  
   retired 1409936  
   IPC 0.890383  
   CPI 1.123112

2. Dual issue  
   cycles 1431792  
   retired 1410008  
   IPC 0.984785  
   CPI 1.015450

## Implemented changes
1. Added CPI reporting in `sim_main.cpp` so each run now reports both IPC and CPI.
2. Refactored `fused_bias_relu_rescale` in `inference_bare.c` with two lane loop unrolling for the ReLU max pass and the rescale pass.
3. Expanded lane1 eligibility in `Riscv151.v` to include `LUI` and `AUIPC` with correct lane1 operand and immediate handling.
4. Relaxed lane0 pairing restriction in `Riscv151.v` so lane1 can pair when lane0 is load or store while still blocking branch jump CSR and M extension cases.

## Decision record
1. Software ILP tuning was done first since it has low correctness risk and gives immediate signal on pairing potential.
2. Lane1 opcode expansion alone gave limited gain because issue count did not move enough in this workload.
3. Pairing policy was then adjusted to allow more practical pairing opportunities in memory heavy code.
4. Each change was accepted only after SI and DI both passed full `make clean && make run`.

## Results
After software ILP refactor only

1. Single issue  
   cycles 1540423  
   retired 1361928  
   IPC 0.884126  
   CPI 1.131061

2. Dual issue  
   cycles 1367431  
   retired 1361927  
   IPC 0.995975  
   CPI 1.004041

After RTL lane1 pairing policy update

1. Single issue  
   cycles 1540423  
   retired 1361928  
   IPC 0.884126  
   CPI 1.131061

2. Dual issue  
   cycles 1336305  
   retired 1361927  
   IPC 1.019174  
   CPI 0.981187

## Net effect from baseline to final
1. Dual issue cycles improved from 1431792 to 1336305  
   cycle reduction 95487  
   relative gain 6.67 percent
2. Dual issue IPC improved from 0.984785 to 1.019174  
   absolute gain 0.034389
3. Dual issue CPI improved from 1.015450 to 0.981187  
   absolute reduction 0.034263
4. Both SI and DI remained passing during all accepted steps.

## Notes
1. The current gain came from practical pairing opportunities in real workload regions rather than synthetic microbench paths.
2. The next stage should add blocker counters in `Riscv151.v` for lane1 suppression causes so further gains are data driven.
